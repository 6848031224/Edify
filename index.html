<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>📂 PGS Finder</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; background: #f5f5f7; color: #333; }
    header { padding: 1em; background: #e5e5ea; border-bottom: 1px solid #d1d1d6; }
    h1 { margin: 0; font-size: 1.2em; font-weight: 500; }
    #breadcrumbs { margin: 0.5em 0 0; font-size: 0.9em; color: #555; }
    #breadcrumbs span { cursor: pointer; color: #0366d6; }
    #breadcrumbs span:hover { text-decoration: underline; }

    .toolbar { padding: 0.5em 1em; background: #f9f9fa; border-bottom: 1px solid #d1d1d6; display: flex; gap: 1em; align-items: center; }
    input[type="text"] { padding: 0.4em; border: 1px solid #ccc; border-radius: 6px; flex: 1; }
    button { padding: 0.4em 0.8em; border: 1px solid #ccc; border-radius: 6px; background: #fff; cursor: pointer; }
    button:hover { background: #f0f0f5; }

    ul { list-style: none; padding-left: 1em; margin: 0; }
    li { margin: 0.2em 0; cursor: pointer; padding: 0.3em 0.4em; border-radius: 6px; display: flex; align-items: center; gap: 0.5em; }
    li:hover { background: #e5e5ea; }
    a { text-decoration: none; color: #0366d6; flex: 1; }
    a:hover { text-decoration: underline; }
    .folder { font-weight: 500; }
    .nested { display: none; margin-left: 1em; }
    .active { display: block; }

    .icon { width: 20px; display: inline-block; text-align: center; }
  </style>
</head>
<body>
  <header>
    <h1>📂 PGS Finder</h1>
    <div id="breadcrumbs"></div>
  </header>
  <div class="toolbar">
    <input type="text" id="search" placeholder="Search..." />
    <button id="expand-all">Expand All</button>
    <button id="collapse-all">Collapse All</button>
  </div>
  <ul id="file-tree"></ul>

  <script>
    const GH_USERNAME = "6848031224";
    const GH_REPO = "Politics-and-Global-Studies-06";
    let FILE_TREE = [];

    function getIcon(name, type) {
      if (type === "dir") return "📁";
      const ext = name.split(".").pop().toLowerCase();
      switch (ext) {
        case "pdf": return "📑";
        case "txt": case "md": return "📝";
        case "csv": case "xls": case "xlsx": return "📊";
        case "png": case "jpg": case "jpeg": case "gif": return "🖼️";
        case "mp3": case "wav": return "🎵";
        case "mp4": case "mov": return "🎞️";
        case "zip": case "rar": return "🗂️";
        default: return "📄";
      }
    }

    async function loadFileTree() {
      try {
        const res = await fetch('./file-tree.json');
        FILE_TREE = await res.json();
        buildTree(document.getElementById('file-tree'), FILE_TREE);
      } catch (err) {
        console.error('Failed to load file-tree.json', err);
      }
    }

    function buildTree(container, items) {
      container.innerHTML = '';
      for (const item of items) {
        const li = document.createElement('li');
        const icon = document.createElement('span');
        icon.className = 'icon';
        icon.textContent = getIcon(item.name, item.type);
        li.appendChild(icon);

        if (item.type === 'dir') {
          const text = document.createElement('span');
          text.textContent = item.name;
          text.className = 'folder';
          li.appendChild(text);

          const nested = document.createElement('ul');
          nested.className = 'nested';
          li.appendChild(nested);

          buildTree(nested, item.children || []);

          text.addEventListener('click', (e) => {
            e.stopPropagation();
            nested.classList.toggle('active');
            updateBreadcrumbs(item.path);
          });

        } else {
          const link = document.createElement('a');
          link.href = `https://raw.githubusercontent.com/${GH_USERNAME}/${GH_REPO}/main/${item.path}`;
          link.textContent = item.name;
          li.appendChild(link);
        }

        container.appendChild(li);
      }
    }

    function updateBreadcrumbs(path) {
      const bc = document.getElementById('breadcrumbs');
      bc.innerHTML = '';
      const parts = path.split('/');
      let accum = '';
      parts.forEach((part, i) => {
        if (i > 0) accum += '/';
        accum += part;
        const span = document.createElement('span');
        span.textContent = part;
        span.addEventListener('click', () => {
          const item = findItemByPath(accum, FILE_TREE);
          if (item && item.children) {
            buildTree(document.getElementById('file-tree'), [item]);
          }
        });
        bc.appendChild(span);
        if (i < parts.length - 1) bc.append(' / ');
      });
    }

    function findItemByPath(path, arr) {
      for (const item of arr) {
        if (item.path === path) return item;
        if (item.type === 'dir' && item.children) {
          const found = findItemByPath(path, item.children);
          if (found) return found;
        }
      }
      return null;
    }

    document.getElementById('search').addEventListener('input', (e) => {
      const term = e.target.value.toLowerCase();
      document.querySelectorAll('li').forEach(li => {
        li.style.display = li.textContent.toLowerCase().includes(term) ? '' : 'none';
      });
    });

    document.getElementById('expand-all').addEventListener('click', () => {
      document.querySelectorAll('.nested').forEach(ul => ul.classList.add('active'));
    });

    document.getElementById('collapse-all').addEventListener('click', () => {
      document.querySelectorAll('.nested').forEach(ul => ul.classList.remove('active'));
    });

    loadFileTree();
  </script>
</body>
</html>
